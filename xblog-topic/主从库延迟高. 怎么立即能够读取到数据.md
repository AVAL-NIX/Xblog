---
submitToken: 6914AD0B58744B06E1BB43D7BD4FC11713865B16F6574B5BC5D771176B12F7C2
title: 主从库延迟高. 怎么立即能够读取到数据
channel: topic
labels: mysql
---

## 流程优化避免写后立即读取

a 业务流程上：写完成后接口返回，客户端再次调用接口获取数据，在这个过程中同步已经完成；

b 代码上：写完成后缓存结果到局部变量，内存或缓存中，下次读取直接走缓存；

## 避免主从延迟，保证读写强一致性

a  如果是一主一从，可以使用数据库提供的半同步复制，写完成时会等待从库同步完成后返回；但是强一致性会降低写吞吐量

b  mysql5.6以后可以使用semi-sync功能，实现强一致性；

c  线上读写都是使用主库，从库只做线下运营，分析使用；为了缓解数据库读写压力，在数据库上架构缓冲层；
## 强制读走主库

## 配置经验延迟时间，延迟时间范围内的查询走主库；

a 中间件实现。很多中间件提供这种配置
b 应用层实现。架构一个缓存层，对数据修改后将key保存在cache总，设置生存时间为经验延迟时间。查询时首先查询cache,如果找到key则强制走主库；
