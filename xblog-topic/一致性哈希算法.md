---
submitToken: 6CC896B7F10D37B75D7DE0290B394F50E151D90CAC63F46D8FF88FC783382144
title: 一致性哈希算法是什么？
channel: topic
labels: base
---

一致性hash算法正是为了解决此类问题的方法，它可以保证当机器增加或者减少时，节点之间的数据迁移只限于两个节点之间，不会造成全局的网络问题。

## 使用简单的hash函数

新增机器时，数据需要重新hash，迁移量大

```
m = hash(o) mod n

其中，o为对象名称，n为机器的数量，m为机器编号。
考虑以下例子：

3个机器节点，10个数据 的哈希值分别为1,2,3,4,…,10。使用的哈希函数为：(m=hash(o) mod 3)
机器0 上保存的数据有：3，6，9
机器1 上保存的数据有：1，4，7，10
机器2 上保存的数据有：2，5，8

当增加一台机器后，此时n = 4，各个机器上存储的数据分别为：

机器0 上保存的数据有：4，8
机器1 上保存的数据有：1，5，9
机器2 上保存的数据有：2，6，10
机器3 上保存的数据有：3，7
只有数据1和数据2没有移动，所以当集群中数据量很大时，采用一般的哈希函数，在节点数量动态变化的情况下会造成大量的数据迁移，导致网络通信压力的剧增，严重情况，还可能导致数据库宕机。
```

## 一致性hash

一致性hash, 新增机器时，数据迁移量仅限2个节点之间，且每个机器只管自己前面的对象数据

![](https://image.avalon-zheng.xin/05c08967-d87a-4e22-9d12-2402f21dbd6b "")

存在的问题：(解决方法——虚拟节点)

当集群中的节点数量较少时，可能会出现节点在哈希空间中分布不平衡的问题。如下图所示，图中节点A、B、C分布较为集中，造成hash环的倾斜。数据1、2、3、4、6全部被存储到了节点A上，节点B上只存储了数据5，而节点C上什么数据都没有存储。A、B、C三台机器的负载极其不均衡。

![](https://image.avalon-zheng.xin/9adeff61-34e1-4f84-838a-f41ba1823e35 "")