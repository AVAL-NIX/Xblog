---
submitToken: 11303CA3CDB1F5FA4014D3FC0CD235FF8B371EA283D754AAC3701E6D73E42BAB
title: Redis 持久化机制(怎么保证 Redis 挂掉之后再重启数据可以进行恢复)？
channel: topic
labels: redis
---

## 持久化文件

RDB: 实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。

> Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑

AOF: 由于该机制对日志文件的写入操作采用的是append模式，因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容。然而如果我们本次操作只是写入了一半数据就出现了系统崩溃问题，不用担心，在Redis下一次启动之前，我们可以通过redis-check-aof工具来帮助我们解决数据一致性的问题。

## 文件恢复区别

对于相同数量的数据集而言，AOF文件通常要大于RDB文件。

RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。

## 数据保存时间

RDB：

- 由于RDB是通过fork子进程来协助完成数据持久化工作的，因此，如果当数据集较大时，可能会导致整个服务器停止服务几百毫秒，甚至是1秒钟。

- 保存间隔时间长，根据次数保存，无法精确到毫秒，中间可能会丢数据

AOF: 支持秒级保存， 而且支持故障恢复


